(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["tinysort"],factory)}else{factory(root.tinysort)}})(this,function(tinysort){"use strict";var fromCharCode=String.fromCharCode,mathmn=Math.min,nll=null,fnIndexOf=Array.prototype.indexOf,plugin=tinysort.plugin,loop=plugin.loop,charOrder,allCharsList=function(a){for(var i=32,s=fromCharCode(i),len=255;i<len;i++,s=fromCharCode(i).toLowerCase()){if(fnIndexOf.call(a,s)===-1)a.push(s)}return a.sort()}([]),orderedCharlist,replacementIndex=9472,replacements={},regexNonLatin=/[^a-zA-Z]/g;tinysort.defaults.charOrder=charOrder;plugin(prepare,sort);function prepare(criterium){if(criterium.charOrder!==charOrder){charOrder=criterium.charOrder;replacementIndex=9472;replacements={};orderedCharlist=nll;if(charOrder){orderedCharlist=allCharsList.slice(0);for(var charListNotLatin=[],addReplacement=function(nonLatin,replacement){charListNotLatin.push(replacement);replacements[criterium.cases?nonLatin:nonLatin.toLowerCase()]=replacement},lastLatinChar="z",l=charOrder.length,j,m,i=0;i<l;i++){var char=charOrder[i],charCode=char.charCodeAt(),charIsLatin=charCode>96&&charCode<123;if(!charIsLatin){if(char==="["){var charsNotLatinNum=charListNotLatin.length,lastChar=charsNotLatinNum?charListNotLatin[charsNotLatinNum-1]:lastLatinChar,replaces=charOrder.substr(i+1).match(/[^\]]*/)[0],doubles=replaces.match(/{[^}]*}/g);if(doubles){for(j=0,m=doubles.length;j<m;j++){var sCode=doubles[j];i+=sCode.length;replaces=replaces.replace(sCode,"");addReplacement(sCode.replace(/[{}]/g,""),lastChar)}}for(j=0,m=replaces.length;j<m;j++){addReplacement(replaces[j],lastChar)}i+=replaces.length+1}else if(char==="{"){var doubleChars=charOrder.substr(i+1).match(/[^}]*/)[0];addReplacement(doubleChars,fromCharCode(replacementIndex++));i+=doubleChars.length+1}else{charListNotLatin.push(char)}}if(charListNotLatin.length&&(charIsLatin||i===l-1)){loop(charListNotLatin,function(s){orderedCharlist.splice(fnIndexOf.call(orderedCharlist,s),1)});var charListNotLatinCopy=charListNotLatin.slice(0);charListNotLatinCopy.splice(0,0,fnIndexOf.call(orderedCharlist,lastLatinChar)+1,0);Array.prototype.splice.apply(orderedCharlist,charListNotLatinCopy);charListNotLatin.length=0}if(charIsLatin)lastLatinChar=char}}}}function sort(criterium,isNumeric,a,b,sortReturn){if(a===b){sortReturn=0}else if(!isNumeric&&criterium.charOrder){for(var replace in replacements){var replacement=replacements[replace];a=a.replace(replace,replacement);b=b.replace(replace,replacement)}if(a.match(regexNonLatin)!==nll||b.match(regexNonLatin)!==nll){for(var k=0,l=mathmn(a.length,b.length);k<l;k++){var iAchr=fnIndexOf.call(orderedCharlist,a[k]),iBchr=fnIndexOf.call(orderedCharlist,b[k]);if(sortReturn=criterium.sortReturnNumber*(iAchr<iBchr?-1:iAchr>iBchr?1:0))break}}else{sortReturn=a===b?0:a>b?1:-1}}return sortReturn}});